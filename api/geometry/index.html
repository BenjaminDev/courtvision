
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CourtVision is library and appication that extracts useful information from videos of court-based games">
      
      
      
        <link rel="canonical" href="https://zizu.co.za/api/geometry/">
      
      
        <link rel="prev" href="../vision/">
      
      
        <link rel="next" href="../data/">
      
      <link rel="icon" href="../../motion_blur_FILL0_wght400_GRAD0_opsz48.svg">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.16">
    
    
      
        <title>courtvision.geometry - CourtVision</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#courtvision.geometry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CourtVision" class="md-header__button md-logo" aria-label="CourtVision" data-md-component="logo">
      
  <img src="../../motion_blur_FILL0_wght400_GRAD0_opsz48.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CourtVision
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              courtvision.geometry
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/benjamindev/courtvision" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    benjamindev/courtvision
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CourtVision" class="md-nav__button md-logo" aria-label="CourtVision" data-md-component="logo">
      
  <img src="../../motion_blur_FILL0_wght400_GRAD0_opsz48.svg" alt="logo">

    </a>
    CourtVision
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/benjamindev/courtvision" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    benjamindev/courtvision
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          API Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          API Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vision/" class="md-nav__link">
        courtvision.vis
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          courtvision.geometry
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        courtvision.geometry
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry" class="md-nav__link">
    courtvision.geometry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.camera_space_to_world_space" class="md-nav__link">
    camera_space_to_world_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.compute_ray_intersecting_plane" class="md-nav__link">
    compute_ray_intersecting_plane()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.convert_corners_to_coords" class="md-nav__link">
    convert_corners_to_coords()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.convert_corners_to_vec" class="md-nav__link">
    convert_corners_to_vec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.convert_obj_points_to_planar" class="md-nav__link">
    convert_obj_points_to_planar()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.denormalize_as_named_points" class="md-nav__link">
    denormalize_as_named_points()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.find_optimal_calibration_and_pose" class="md-nav__link">
    find_optimal_calibration_and_pose()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.get_planar_point_correspondences" class="md-nav__link">
    get_planar_point_correspondences()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.project_points_to_base_plane" class="md-nav__link">
    project_points_to_base_plane()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.solve_for_camera_matrix" class="md-nav__link">
    solve_for_camera_matrix()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        courtvision.data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trackers/" class="md-nav__link">
        courtvision.trackers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trainer/" class="md-nav__link">
        courtvision.trainer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../console/" class="md-nav__link">
        courtvision.console
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        courtvision.pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../swiss/" class="md-nav__link">
        courtvision.swiss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        courtvision.models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        courtvision.config
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry" class="md-nav__link">
    courtvision.geometry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.camera_space_to_world_space" class="md-nav__link">
    camera_space_to_world_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.compute_ray_intersecting_plane" class="md-nav__link">
    compute_ray_intersecting_plane()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.convert_corners_to_coords" class="md-nav__link">
    convert_corners_to_coords()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.convert_corners_to_vec" class="md-nav__link">
    convert_corners_to_vec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.convert_obj_points_to_planar" class="md-nav__link">
    convert_obj_points_to_planar()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.denormalize_as_named_points" class="md-nav__link">
    denormalize_as_named_points()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.find_optimal_calibration_and_pose" class="md-nav__link">
    find_optimal_calibration_and_pose()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.get_planar_point_correspondences" class="md-nav__link">
    get_planar_point_correspondences()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.project_points_to_base_plane" class="md-nav__link">
    project_points_to_base_plane()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#courtvision.geometry.solve_for_camera_matrix" class="md-nav__link">
    solve_for_camera_matrix()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>courtvision.geometry</h1>

<div class="doc doc-object doc-module">


<a id="courtvision.geometry"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.camera_space_to_world_space" class="doc doc-heading">
<code class="highlight language-python"><span class="n">camera_space_to_world_space</span><span class="p">(</span><span class="n">camera_point</span><span class="p">,</span> <span class="n">translation_vector</span><span class="p">,</span> <span class="n">rotation_vector</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Transform a point from camera space to world space.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>camera_point</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>3D point in camera space with shape (3,)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>translation_vector</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Translation vector of the camera with shape (3,)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rotation_vector</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Rotation vector of the camera with shape (3,)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the camera point is not a 3D point with shape (3,)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.array: 3D point in world space with shape (3,)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">camera_space_to_world_space</span><span class="p">(</span>
    <span class="n">camera_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">translation_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">rotation_vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform a point from camera space to world space.</span>

<span class="sd">    Args:</span>
<span class="sd">        camera_point (np.array): 3D point in camera space with shape (3,)</span>
<span class="sd">        translation_vector (np.array): Translation vector of the camera with shape (3,)</span>
<span class="sd">        rotation_vector (np.array): Rotation vector of the camera with shape (3,)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the camera point is not a 3D point with shape (3,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array: 3D point in world space with shape (3,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">camera_point</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Camera point must be a 3D point with shape (3,)&quot;</span><span class="p">)</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Rodrigues</span><span class="p">(</span><span class="n">rotation_vector</span><span class="p">)</span>
    <span class="n">world_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">camera_point</span> <span class="o">-</span> <span class="n">translation_vector</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">world_point</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.compute_ray_intersecting_plane" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_ray_intersecting_plane</span><span class="p">(</span><span class="n">point_a_on_ray</span><span class="p">,</span> <span class="n">point_b_on_ray</span><span class="p">,</span> <span class="n">plane_normal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span> <span class="n">plane_point</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given two points on a ray, compute the point of intersection with a plane.
The plane is defined as a normal vector and a point on the plane.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>point_a_on_ray</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>3D point on the ray with shape (3, 1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>point_b_on_ray</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>3D point on the ray with shape (3, 1)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>plane_normal</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Unit vector pointing out the plane. Defaults to np.array([[0, 0, 1]]). Shape (1, 3)</p>
            </div>
          </td>
          <td>
                <code>np.array([[0, 0, 1]])</code>
          </td>
        </tr>
        <tr>
          <td><code>plane_point</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Point on the plane. Defaults to np.array([0, 0, 0]). Shape (3,)</p>
            </div>
          </td>
          <td>
                <code>np.array([0, 0, 0])</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.array: Returns the 3D point of intersection with shape (3,)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_ray_intersecting_plane</span><span class="p">(</span>
    <span class="n">point_a_on_ray</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">point_b_on_ray</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">plane_normal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">plane_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given two points on a ray, compute the point of intersection with a plane.</span>
<span class="sd">    The plane is defined as a normal vector and a point on the plane.</span>

<span class="sd">    Args:</span>
<span class="sd">        point_a_on_ray (np.array): 3D point on the ray with shape (3, 1)</span>
<span class="sd">        point_b_on_ray (np.array): 3D point on the ray with shape (3, 1)</span>
<span class="sd">        plane_normal (np.array, optional): Unit vector pointing out the plane. Defaults to np.array([[0, 0, 1]]). Shape (1, 3)</span>
<span class="sd">        plane_point (np.array, optional): Point on the plane. Defaults to np.array([0, 0, 0]). Shape (3,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array: Returns the 3D point of intersection with shape (3,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Vector along the ray direction A -&gt; B</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">point_a_on_ray</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">point_b_on_ray</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Point A and B must be 3D points with shape (3, 1). </span><span class="si">{</span><span class="n">point_a_on_ray</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">point_b_on_ray</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plane_normal</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">plane_normal</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Plane normal must be a unit vector with shape (1, 3) and norm 1&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plane_point</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Plane point must be a 3D point with shape (3,)&quot;</span><span class="p">)</span>

    <span class="n">ray_direction</span> <span class="o">=</span> <span class="n">point_b_on_ray</span> <span class="o">-</span> <span class="n">point_a_on_ray</span>
    <span class="c1"># Finding parameter t</span>
    <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane_normal</span><span class="p">,</span> <span class="n">point_a_on_ray</span><span class="p">)</span> <span class="o">+</span> <span class="n">plane_point</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
        <span class="n">plane_normal</span><span class="p">,</span> <span class="n">ray_direction</span>
    <span class="p">)</span>
    <span class="c1"># Finding point of intersection</span>
    <span class="n">intersection</span> <span class="o">=</span> <span class="p">(</span><span class="n">point_a_on_ray</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">ray_direction</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">intersection</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.convert_corners_to_coords" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_corners_to_coords</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert <code>corners_world_xx_n</code> to a numpy array of shape (12,)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>corners</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: numpy array of shape (12,)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_corners_to_coords</span><span class="p">(</span><span class="n">corners</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert `corners_world_xx_n` to a numpy array of shape (12,)</span>

<span class="sd">    Args:</span>
<span class="sd">        corners (dict):</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: numpy array of shape (12,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vec_of_positions</span> <span class="o">=</span> <span class="n">convert_corners_to_vec</span><span class="p">(</span><span class="n">corners</span><span class="o">=</span><span class="n">corners</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;z&quot;</span> <span class="ow">in</span> <span class="n">vec_of_positions</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">vec_of_positions</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">vec_of_positions</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">vec_of_positions</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vec_of_positions</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">vec_of_positions</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])],</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.convert_corners_to_vec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_corners_to_vec</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert <code>corners_world_xx_n</code> to a dict of vectors</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>corners</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dict with keys x, y, z and numpy array of each</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_corners_to_vec</span><span class="p">(</span><span class="n">corners</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert `corners_world_xx_n` to a dict of vectors</span>

<span class="sd">    Args:</span>
<span class="sd">        corners (dict):</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: dict with keys x, y, z and numpy array of each</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vec_of_positions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x_y_z</span> <span class="ow">in</span> <span class="n">corners</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">x_y_z</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">vec_of_positions</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vec_of_positions</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vec_of_positions</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.convert_obj_points_to_planar" class="doc doc-heading">
<code class="highlight language-python"><span class="n">convert_obj_points_to_planar</span><span class="p">(</span><span class="n">object_points</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Converts object points to planar points by finding the common axis and permuting the points so that the common axis is the last axis.
Assumes that the object points are planar.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>object_points</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When points are not planar</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.array: <em>description</em></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_obj_points_to_planar</span><span class="p">(</span><span class="n">object_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts object points to planar points by finding the common axis and permuting the points so that the common axis is the last axis.</span>
<span class="sd">    Assumes that the object points are planar.</span>

<span class="sd">    Args:</span>
<span class="sd">        object_points (np.array): _description_</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: When points are not planar</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">common_axis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">object_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">==</span> <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">object_points</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">]):</span>
            <span class="n">common_axis</span> <span class="o">=</span> <span class="n">axis</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">common_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not find common axis&quot;</span><span class="p">)</span>
    <span class="c1"># permute the object points so that the common axis is the last axis</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">object_points</span><span class="p">[:,</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">common_axis</span><span class="p">]],</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">object_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.denormalize_as_named_points" class="doc doc-heading">
<code class="highlight language-python"><span class="n">denormalize_as_named_points</span><span class="p">(</span><span class="n">normalised_named_points</span><span class="p">,</span> <span class="n">image_width</span><span class="p">,</span> <span class="n">image_height</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Transforms a dict of normalized points <code>0 to 1</code> to image points using the
supplied image dimension.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>normalised_named_points</code></td>
          <td>
                <code>dict[str, <span title="courtvision.geometry.Point2D">Point2D</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dict of points normalised from <code>0.0</code> to <code>1.0</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image width to expand to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image height to expand to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict[str, <span title="courtvision.geometry.Point2D">Point2D</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dict[str, Point2D]: Retruns a dict of similar struture but with image points.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">denormalize_as_named_points</span><span class="p">(</span>
    <span class="n">normalised_named_points</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Point2D</span><span class="p">],</span> <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Point2D</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms a dict of normalized points `0 to 1` to image points using the</span>
<span class="sd">    supplied image dimension.</span>

<span class="sd">    Args:</span>
<span class="sd">        normalised_named_points (dict[str, Point2D]): Dict of points normalised from `0.0` to `1.0`</span>
<span class="sd">        image_width (int): Image width to expand to.</span>
<span class="sd">        image_height (int): Image height to expand to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Point2D]: Retruns a dict of similar struture but with image points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_width</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_height</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">normalised_named_points</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.find_optimal_calibration_and_pose" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_optimal_calibration_and_pose</span><span class="p">(</span><span class="n">valid_clip_ids</span><span class="p">,</span> <span class="n">calibration_correspondences</span><span class="p">,</span> <span class="n">pose_correspondences</span><span class="p">,</span> <span class="n">image_width</span><span class="p">,</span> <span class="n">image_height</span><span class="p">,</span> <span class="n">all_image_points</span><span class="p">,</span> <span class="n">all_world_points</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Givern a set of calibration and pose correspondences, find the optimal calibration and pose.
This is done by building up combinations of these sets and evaluating the reprojection error.
The reprojection error is the mean of the euclidean distance between the reprojected points and the actual points.
The evvaluation is on all <code>all_image_points</code> and <code>all_world_points</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>valid_clip_ids</code></td>
          <td>
                <code>set[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>calibration_correspondences</code></td>
          <td>
                <code>list[tuple[<span title="numpy">np</span>.<span title="numpy.array">array</span>, <span title="numpy">np</span>.<span title="numpy.array">array</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pose_correspondences</code></td>
          <td>
                <code>list[tuple[<span title="numpy">np</span>.<span title="numpy.array">array</span>, <span title="numpy">np</span>.<span title="numpy.array">array</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image width</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image height</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>all_image_points</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>3D points that we want to reproject.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>all_world_points</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D points that are where we expect the 3D points to be reprojected to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>RuntimeError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>CameraInfo</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="courtvision.data.CameraInfo" href="../data/#courtvision.data.CameraInfo">CameraInfo</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_optimal_calibration_and_pose</span><span class="p">(</span>
    <span class="n">valid_clip_ids</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">calibration_correspondences</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]],</span>
    <span class="n">pose_correspondences</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]],</span>
    <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">all_image_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">all_world_points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CameraInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Givern a set of calibration and pose correspondences, find the optimal calibration and pose.</span>
<span class="sd">    This is done by building up combinations of these sets and evaluating the reprojection error.</span>
<span class="sd">    The reprojection error is the mean of the euclidean distance between the reprojected points and the actual points.</span>
<span class="sd">    The evvaluation is on all `all_image_points` and `all_world_points`.</span>

<span class="sd">    Args:</span>
<span class="sd">        valid_clip_ids (set[str]): _description_</span>
<span class="sd">        calibration_correspondences (list[tuple[np.array, np.array]]): _description_</span>
<span class="sd">        pose_correspondences (list[tuple[np.array, np.array]]): _description_</span>
<span class="sd">        image_width (int): Image width</span>
<span class="sd">        image_height (int): Image height</span>
<span class="sd">        all_image_points (np.array): 3D points that we want to reproject.</span>
<span class="sd">        all_world_points (np.array): 2D points that are where we expect the 3D points to be reprojected to.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        CameraInfo: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CALIBRATION_MIN_PAIRS</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">CALIBRATION_MAX_PAIRS</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calibration_correspondences</span><span class="p">))</span>

    <span class="n">POSE_MIN_PAIRS</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">POSE_MAX_PAIRS</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pose_correspondences</span><span class="p">))</span>

    <span class="n">calibration_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">calibration_correspondences</span><span class="p">))]</span>
    <span class="n">calibration_selected_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">calibration_indexes</span><span class="p">,</span> <span class="n">num_pairs_to_use</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">num_pairs_to_use</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">CALIBRATION_MIN_PAIRS</span><span class="p">,</span> <span class="n">CALIBRATION_MAX_PAIRS</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">pose_indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pose_correspondences</span><span class="p">))]</span>
    <span class="n">pose_selected_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">pose_indexes</span><span class="p">,</span> <span class="n">num_pairs_to_use</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">num_pairs_to_use</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">POSE_MIN_PAIRS</span><span class="p">,</span> <span class="n">POSE_MAX_PAIRS</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">best_error_in_reprojected_points</span> <span class="o">=</span> <span class="mf">10000.0</span>
    <span class="n">best_camera_info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">calibration_pair</span><span class="p">,</span> <span class="n">pose_pair</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
        <span class="n">calibration_selected_pairs</span><span class="p">,</span> <span class="n">pose_selected_pairs</span>
    <span class="p">):</span>
        <span class="n">calibration_correspondences_selection</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">calibration_correspondences</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">calibration_pair</span>
        <span class="p">]</span>
        <span class="n">pose_correspondences_selection</span> <span class="o">=</span> <span class="p">[</span><span class="n">pose_correspondences</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">pose_pair</span><span class="p">]</span>

        <span class="n">camera_info</span> <span class="o">=</span> <span class="n">calibrate_and_evaluate</span><span class="p">(</span>
            <span class="n">valid_clip_ids</span><span class="o">=</span><span class="n">valid_clip_ids</span><span class="p">,</span>
            <span class="n">calibration_correspondences_selected</span><span class="o">=</span><span class="n">calibration_correspondences_selection</span><span class="p">,</span>
            <span class="n">pose_correspondences_selected</span><span class="o">=</span><span class="n">pose_correspondences_selection</span><span class="p">,</span>
            <span class="n">image_width</span><span class="o">=</span><span class="n">image_width</span><span class="p">,</span>
            <span class="n">image_height</span><span class="o">=</span><span class="n">image_height</span><span class="p">,</span>
            <span class="n">all_image_points</span><span class="o">=</span><span class="n">all_image_points</span><span class="p">,</span>
            <span class="n">all_world_points</span><span class="o">=</span><span class="n">all_world_points</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">camera_info</span><span class="o">.</span><span class="n">error_in_reprojected_points</span> <span class="o">&lt;</span> <span class="n">best_error_in_reprojected_points</span><span class="p">:</span>
            <span class="n">best_camera_info</span> <span class="o">=</span> <span class="n">camera_info</span>
    <span class="k">if</span> <span class="n">best_camera_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to find optimal calibration and pose&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_camera_info</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.get_planar_point_correspondences" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_planar_point_correspondences</span><span class="p">(</span><span class="n">world_points</span><span class="p">,</span> <span class="n">image_points</span><span class="p">,</span> <span class="n">available_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimal_set_count</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given a set of named points in the world and image, return a list of point correspondences
where all points are coplanar.
If a specified set <code>available_labels</code> is given, only return point correspondences where all
points are in that set.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>world_points</code></td>
          <td>
                <code>dict[str, tuple[float, float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dict of named points in the world coordinate frame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_points</code></td>
          <td>
                <code>dict[str, tuple[float, float]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dict of named points in the image coordinate frame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>available_labels</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[set[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set of labels to use if None all labels are used. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>minimal_set_count</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sets of corresponding points . Defaults to 4.</p>
            </div>
          </td>
          <td>
                <code>4</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[tuple[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list[tuple[np.ndarray, np.ndarray]]: Returns a list of point correspondences where all points are coplanar.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code>list[tuple[<span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list[tuple[Nx3, Nx2]]</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_planar_point_correspondences</span><span class="p">(</span>
    <span class="n">world_points</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">image_points</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">available_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">minimal_set_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a set of named points in the world and image, return a list of point correspondences</span>
<span class="sd">    where all points are coplanar.</span>
<span class="sd">    If a specified set `available_labels` is given, only return point correspondences where all</span>
<span class="sd">    points are in that set.</span>
<span class="sd">    Args:</span>
<span class="sd">        world_points (dict[str, tuple[float, float]]): Dict of named points in the world coordinate frame.</span>
<span class="sd">        image_points (dict[str, tuple[float, float]]): Dict of named points in the image coordinate frame.</span>
<span class="sd">        available_labels (Optional[set[str]], optional): Set of labels to use if None all labels are used. Defaults to None.</span>
<span class="sd">        minimal_set_count (int, optional): Sets of corresponding points . Defaults to 4.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple[np.ndarray, np.ndarray]]: Returns a list of point correspondences where all points are coplanar.</span>
<span class="sd">        list[tuple[Nx3, Nx2]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">available_labels</span> <span class="o">=</span> <span class="n">available_labels</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">(</span><span class="n">image_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">available_planes_for_calibration</span> <span class="o">=</span> <span class="n">get_planar_points_padel_court</span><span class="p">(</span>
        <span class="n">available_labels</span><span class="o">=</span><span class="n">available_labels</span><span class="p">,</span>
        <span class="n">minimal_set_count</span><span class="o">=</span><span class="n">minimal_set_count</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="kn">from</span> <span class="nn">courtvision.data</span> <span class="kn">import</span> <span class="n">dict_to_points</span>

    <span class="n">planar_point_correspondences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">plane</span> <span class="ow">in</span> <span class="n">available_planes_for_calibration</span><span class="p">:</span>
        <span class="n">world_points_on_plane_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">world_points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">}</span>
        <span class="n">image_points_on_plane_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">image_points</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">plane</span><span class="p">}</span>
        <span class="n">world_points_on_plane</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dict_to_points</span><span class="p">(</span><span class="n">world_points_on_plane_dict</span><span class="p">)</span>
        <span class="n">image_points_on_plane</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dict_to_points</span><span class="p">(</span><span class="n">image_points_on_plane_dict</span><span class="p">)</span>
        <span class="n">planar_point_correspondences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">world_points_on_plane</span><span class="p">,</span> <span class="n">image_points_on_plane</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">planar_point_correspondences</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.project_points_to_base_plane" class="doc doc-heading">
<code class="highlight language-python"><span class="n">project_points_to_base_plane</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given homogeneous points or 2D points and a homography, project the points to the base plane</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>points</code></td>
          <td>
                <code>torch.<span title="torch.tensor">tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Homogeneous points or 2D points</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>H</code></td>
          <td>
                <code>torch.<span title="torch.tensor">tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Homography 3x3 matrix</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If <code>points</code> is not of length 2 or 3</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.tensor">tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>torch.tensor: Projected points in either homogeneous or 2D corrdinates. Same as <code>points</code></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">project_points_to_base_plane</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">,</span> <span class="n">H</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given homogeneous points or 2D points and a homography, project the points to the base plane</span>

<span class="sd">    Args:</span>
<span class="sd">        points (torch.tensor): Homogeneous points or 2D points</span>
<span class="sd">        H (torch.tensor): Homography 3x3 matrix</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `points` is not of length 2 or 3</span>

<span class="sd">    Returns:</span>
<span class="sd">        torch.tensor: Projected points in either homogeneous or 2D corrdinates. Same as `points`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">convert_points_from_homogeneous</span><span class="p">(</span>
            <span class="n">convert_points_to_homogeneous</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">@</span> <span class="n">H</span><span class="o">.</span><span class="n">T</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">points</span> <span class="o">@</span> <span class="n">H</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2"> must be of length 2 or 3.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="courtvision.geometry.solve_for_camera_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">solve_for_camera_matrix</span><span class="p">(</span><span class="n">world_points</span><span class="p">,</span> <span class="n">image_points</span><span class="p">,</span> <span class="n">image_size</span><span class="p">,</span> <span class="n">repo_erro_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>From a set of world points and image points, solve for the camera matrix and distortion coefficients.
Note: All world points must have the same z value. i.e lie on the same plane.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>world_points</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of world points.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_points</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tensor of image points.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_size</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image dimensions as (Width, Height).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>repo_error</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reprojection error measured in pixels. Defaults to 1e-1.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns (Tuple[torch.Tensor, torch.Tensor, float]): camera_matrix (3x3), dist_coeffs (1x5), repo_erro</p>

      <details class="quote">
        <summary>Source code in <code>courtvision/geometry.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solve_for_camera_matrix</span><span class="p">(</span>
    <span class="n">world_points</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">image_points</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">repo_erro_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From a set of world points and image points, solve for the camera matrix and distortion coefficients.</span>
<span class="sd">    Note: All world points must have the same z value. i.e lie on the same plane.</span>

<span class="sd">    Args:</span>
<span class="sd">        world_points (torch.Tensor): Tensor of world points.</span>
<span class="sd">        image_points (torch.Tensor): Tensor of image points.</span>
<span class="sd">        image_size (tuple[int, int]): Image dimensions as (Width, Height).</span>
<span class="sd">        repo_error (float, optional): Reprojection error measured in pixels. Defaults to 1e-1.</span>

<span class="sd">    Returns (Tuple[torch.Tensor, torch.Tensor, float]): camera_matrix (3x3), dist_coeffs (1x5), repo_erro</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">world_points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">_world_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">world_points</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">world_points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">_world_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">world_points</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">world_points</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2"> must be of length 2 or 3.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">_image_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_points</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">_image_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">image_points</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_points</span><span class="o">.</span><span class="n">shape</span><span class="si">=}</span><span class="s2"> must be of length 2 or 3.&quot;</span><span class="p">)</span>

    <span class="c1"># if not all(o[-1] == _world_points[0][0][-1] for o in _world_points[0]):</span>
    <span class="c1"># raise RuntimeError(f&quot;{_world_points=} must have same z value&quot;)</span>
    <span class="n">criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_EPS</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TERM_CRITERIA_MAX_ITER</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>

    <span class="n">repo_erro</span><span class="p">,</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">dist_coeffs</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calibrateCamera</span><span class="p">(</span>
        <span class="n">objectPoints</span><span class="o">=</span><span class="n">_world_points</span><span class="p">,</span>
        <span class="n">imagePoints</span><span class="o">=</span><span class="n">_image_points</span><span class="p">,</span>
        <span class="n">imageSize</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span>
        <span class="n">cameraMatrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">distCoeffs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">criteria</span><span class="o">=</span><span class="n">criteria</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">repo_erro</span> <span class="o">&gt;</span> <span class="n">repo_erro_threshold</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">repo_erro</span><span class="si">=}</span><span class="s2"> must be less than 1e-6&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">repo_erro</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">camera_matrix</span><span class="p">,</span> <span class="n">dist_coeffs</span><span class="p">,</span> <span class="n">repo_erro</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a51614de.min.js"></script>
      
    
  </body>
</html>